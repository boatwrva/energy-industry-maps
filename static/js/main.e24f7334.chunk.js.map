{"version":3,"sources":["taxonomy-colors.js","common.js","CompanyFilter.js","CompanySelector.js","data-loader.js","App.js","index.js"],"names":["TAXONOMY_COLORS","DISPLAY_CATEGORIES","Object","keys","CIRCLE_COLORS","entries","flat","concat","normalizeCategory","s","toLowerCase","replace","CompanyFilter","props","state","displayCategories","handleSelectCategory","bind","selectAll","deselectAll","toggleDisplayCategoryList","this","onSelectAllCategories","onDeselectAllCategories","e","onToggleCategory","setState","tableRows","map","category","sanitizedCat","checkboxId","isChecked","selectedCategories","has","key","type","id","name","checked","onChange","className","style","background","htmlFor","onClick","React","Component","CompanySelector","option","handleChange","onSelectCompany","value","options","companies","f","properties","company","label","placeholder","DATASETS_ENDPOINT","USER","process","DATASET_ID","POINT_LAYER","compileCategoryList","companiesGeojson","c","Set","features","values","Array","from","sort","mapboxgl","accessToken","App","center","zoom","minZoom","handleToggleCategory","handleSelectAllCategories","handleDeselectAllCategories","handleSelectCompany","displayPopup","feature","coordinates","geometry","slice","popUps","document","getElementsByClassName","remove","Popup","setLngLat","setHTML","categoryInfo","k","filter","join","getPopupContent","setMaxWidth","addTo","Map","container","mapContainer","on","lng","getCenter","toFixed","lat","getZoom","addControl","FullscreenControl","NavigationControl","url","fetch","then","response","text","data","JSON","parse","parsed","forEach","city","tax1","tax2","tax3","website","newprop","loadGeojsonData","categories","addSource","addLayer","source","paint","stops","getCanvas","cursor","flyTo","speed","target","delete","add","normalized","selectedCompany","find","getLayer","filters","i","push","setFilter","ref","el","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.e24f7334.chunk.js","sourcesContent":["const BROWN = '#603e1e'\n\nconst TAXONOMY_COLORS = {\n  'Academia/Research': '#07a4bc',\n  'Accelerator/Incubator': '#c30',\n  'Biofuels': '#7cc908',\n  'Buildings': '#036',\n  'Chemistry': '#c94208',\n  'Circular Economy': '#5a8925',\n  'Construction': BROWN,\n  'Enabling Technology/Components': BROWN,\n  'Energy Systems/Management': '#40a22a',\n  'Engineering': BROWN,\n  'Environmental Remediation': '#89256e',\n  'Evaluation/Compliance': '#9e4e16',\n  'Finance': '#269e11',\n  'Generation/Transmission': '#f80',\n  'Geology': '#9e4e16',\n  'Hydrogen': '#2cf',\n  'IIoT/IoT': '#a92278',\n  'Lighting': '#f4f390',\n  'Manufacturing': '#7b16ce',\n  'Materials': '#7b16ce',\n  'Media': '#d11265',\n  'Mobility as a Service': '#b75e35',\n  'Nuclear': '#f0f',\n  'Oil and Gas': '#ce3b16',\n  'Policy': '#660',\n  'Professional Services': '#164d82',\n  'Security/Cybersecurity': '#2c86f4',\n  'Sensors': '#dd4465',\n  'Solar': '#fce119',\n  'Storage': '#093',\n  'Sustainable Agriculture': '#898925',\n  'Thermal Energy': '#bc6d4b',\n  'Utility/Grid': '#f4a41a',\n  'Wave/Water/Hydro': '#20dbdb',\n  'Wind': '#167d7f',\n};\n\nconst DISPLAY_CATEGORIES = Object.keys(TAXONOMY_COLORS);\n\n// Last entry is fallthrough color\nconst CIRCLE_COLORS = Object.entries(TAXONOMY_COLORS).flat().concat(['#ccc']);\n\nexport { TAXONOMY_COLORS, DISPLAY_CATEGORIES, CIRCLE_COLORS };\n","const normalizeCategory = s => s.toLowerCase().replace(/[/ ]/g, '-');\n\nexport { normalizeCategory };\n","import React from 'react';\nimport { TAXONOMY_COLORS, DISPLAY_CATEGORIES } from './taxonomy-colors.js';\nimport { normalizeCategory } from './common.js';\n\nclass CompanyFilter extends React.Component {\n  state = {\n    displayCategories: true,\n  };\n\n  constructor(props) {\n    super(props);\n    this.handleSelectCategory = this.handleSelectCategory.bind(this);\n    this.selectAll = this.selectAll.bind(this);\n    this.deselectAll = this.deselectAll.bind(this);\n    this.toggleDisplayCategoryList = this.toggleDisplayCategoryList.bind(this);\n  }\n\n  selectAll() { this.props.onSelectAllCategories(); }\n\n  deselectAll() { this.props.onDeselectAllCategories(); }\n\n  handleSelectCategory(e) { this.props.onToggleCategory(e); }\n\n  toggleDisplayCategoryList() {\n    const displayCategories = this.state.displayCategories;\n    this.setState({displayCategories: !displayCategories});\n  }\n\n  render() {\n    const tableRows = DISPLAY_CATEGORIES.map(category => {\n      const sanitizedCat = normalizeCategory(category);\n      const checkboxId = `${sanitizedCat}-checkbox`;\n      const isChecked = this.props.selectedCategories.has(sanitizedCat);\n      return (\n        <tr key={sanitizedCat}>\n          <td>\n            <input\n              type=\"checkbox\"\n              id={checkboxId}\n              name={sanitizedCat}\n              checked={isChecked}\n              onChange={this.handleSelectCategory} />\n          </td>\n          <td>\n            <i className=\"category-legend\"\n            style={{background: TAXONOMY_COLORS[category]}}></i>\n          </td>\n          <td><label htmlFor={checkboxId}>{category}</label></td>\n        </tr>);\n    });\n\n    return (\n      <div id=\"company-filter\" className={this.state.displayCategories ? null : \"hidden\"}>\n        <button id=\"filter-toggle\" onClick={this.toggleDisplayCategoryList}>\n          <div className=\"flex-row\">\n            <div className=\"flex-grow\"><span className=\"header\">Filter by category</span></div>\n            <div className=\"hamburger-menu\"><div></div><div></div><div></div></div>\n          </div>\n        </button>\n        <div className=\"content\">\n          <div>\n            <button id=\"select-all\" className=\"select-all\" onClick={this.selectAll}>Select all</button>\n            <button id=\"select-none\" className=\"select-all\" onClick={this.deselectAll}>Clear all</button>\n            <table id=\"categories\"><tbody>{tableRows}</tbody></table>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default CompanyFilter;\n","import React from 'react';\nimport Select from 'react-select';\n\nclass CompanySelector extends React.Component {\n  state = {option: ''};\n\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(option) {\n    this.setState({option: option});\n    this.props.onSelectCompany(option.value);\n  }\n\n  render() {\n    var options = [];\n    if (this.props.companies) {\n      const companies = this.props.companies.map(f => f.properties.company);\n      options = companies.map(company => {\n        return {value: company, label: company};\n      });\n    }\n    return (\n      <div id=\"place-search\">\n        <Select\n          options={options}\n          placeholder=\"Search...\"\n          onChange={this.handleChange}\n          value={this.state.option} />\n      </div>);\n  }\n}\n\nexport default CompanySelector;\n","import mapboxgl from 'mapbox-gl';\nimport { normalizeCategory } from './common.js';\n\nconst DATASETS_ENDPOINT = \"https://api.mapbox.com/datasets/v1\";\nconst USER = process.env.REACT_APP_MAPBOX_USER;\n// TODO: Parameterize over dataset id, as we will want the flexibility to load\n// other datasets.\nconst DATASET_ID = \"ck901ssdl1sxn2mmnj56s9ibm\";\n\nfunction loadGeojsonData() {\n  let url = `${DATASETS_ENDPOINT}/${USER}/${DATASET_ID}/features?access_token=${mapboxgl.accessToken}`;\n  return fetch(url)\n    .then(response => response.text())\n    .then(data => JSON.parse(data))\n    .then(parsed => {\n      parsed.features.forEach(feature => {\n        // filter properties (TODO: Can we change this dataset-side?)\n        feature.properties = {\n          'company': feature.properties.company,\n          'city': feature.properties.city,\n          'tax1': feature.properties.tax1,\n          'tax2': feature.properties.tax2,\n          'tax3': feature.properties.tax3,\n          'website': feature.properties.website,\n        };\n        ['tax1', 'tax2', 'tax3'].forEach(label => {\n          const newprop = `${label}sanitized`;\n          feature.properties[newprop] = normalizeCategory(feature.properties[label]);\n        })\n      });\n      return parsed;\n    });\n}\n\nexport { loadGeojsonData };\n","import React from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport CompanyFilter from './CompanyFilter.js';\nimport CompanySelector from './CompanySelector.js';\nimport { CIRCLE_COLORS, DISPLAY_CATEGORIES } from './taxonomy-colors.js';\nimport { loadGeojsonData } from './data-loader.js';\nimport { normalizeCategory } from './common.js';\nimport './App.css';\n\nconst POINT_LAYER = 'energy-companies-point-layer'\n\nmapboxgl.accessToken = process.env.REACT_APP_MAPBOX_API_TOKEN;\n\nfunction getPopupContent(props) {\n  const categoryInfo = ['tax1', 'tax2', 'tax3']\n    .map(k => props[k])\n    .filter(s => s).join(\" | \");\n  return `\n    <div class=\"popup\">\n      <h3 class=\"company-name\">${props['company']}</h3>\n      <span class=\"category-info\">${categoryInfo}</span><br />\n      <span class=\"city-info\">${props['city']}</span><br />\n      <span><a href=${props['website']} target=\"blank\">${props['website']}</a></span>\n    </div>`;\n}\n\nfunction compileCategoryList(companiesGeojson) {\n  const c = new Set(companiesGeojson.features.map(f => f.properties['tax1']));\n  return Object.values(Array.from(c)).sort();\n}\n\nclass App extends React.Component {\n  map;\n  state = {\n    center: [-121, 36.5],\n    zoom: 6,\n    minZoom: 6,\n    companiesGeojson: {},\n    selectedCategories: new Set(),\n  };\n\n  constructor(props) {\n    super(props);\n    this.handleToggleCategory = this.handleToggleCategory.bind(this);\n    this.handleSelectAllCategories = this.handleSelectAllCategories.bind(this);\n    this.handleDeselectAllCategories = this.handleDeselectAllCategories.bind(this);\n    this.handleSelectCompany = this.handleSelectCompany.bind(this);\n    this.displayPopup = this.displayPopup.bind(this);\n  }\n\n  displayPopup(feature) {\n    const coordinates = feature.geometry.coordinates.slice();\n    var popUps = document.getElementsByClassName('mapboxgl-popup');\n    // Check if there is already a popup on the map and if so, remove it\n    // This prevents multiple popups in the case of overlapping circles\n    if (popUps[0]) popUps[0].remove();\n\n    new mapboxgl.Popup({})\n      .setLngLat(coordinates)\n      .setHTML(getPopupContent(feature.properties))\n      .setMaxWidth(\"40vw\")\n      .addTo(this.map);\n  }\n\n  componentDidMount() {\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/mapbox/dark-v10',\n      center: this.state.center,\n      zoom: this.state.zoom,\n      minZoom: this.state.minZoom,\n    });\n\n    this.map.on('move', () => {\n      this.setState({\n        lng: this.map.getCenter().lng.toFixed(4),\n        lat: this.map.getCenter().lat.toFixed(4),\n        zoom: this.map.getZoom().toFixed(2)\n      });\n    });\n\n    this.map.on('load', () => {\n      this.map.addControl(new mapboxgl.FullscreenControl(), 'bottom-left');\n      this.map.addControl(new mapboxgl.NavigationControl(), 'bottom-left');\n\n      loadGeojsonData().then(companiesGeojson => {\n        this.setState({\n          companiesGeojson: companiesGeojson,\n          categories: compileCategoryList(companiesGeojson),\n        });\n\n        // initially select all categories\n        this.handleSelectAllCategories();\n\n        this.map.addSource('companies', {\n          type: 'geojson',\n          data: companiesGeojson,\n        });\n\n        this.map.addLayer({\n          id: POINT_LAYER,\n          type: 'circle',\n          source: 'companies',\n          paint: {\n            // make circles larger as the user zooms\n            'circle-radius': {\n              stops: [[7, 5], [14, 12], [20, 50]]\n            },\n            'circle-opacity': 0.85,\n            // color circles by primary category\n            'circle-color': ['match', ['get', 'tax1']].concat(CIRCLE_COLORS),\n            'circle-stroke-color': '#fff',\n            'circle-stroke-width': 0.4,\n          }\n        });\n\n        this.map.on('mouseenter', POINT_LAYER, (e) => {\n          this.map.getCanvas().style.cursor = 'pointer';\n        });\n\n        this.map.on('mouseleave', POINT_LAYER, () => {\n          this.map.getCanvas().style.cursor = '';\n        });\n\n        this.map.on('click', POINT_LAYER, e => this.displayPopup(e.features[0]));\n      });\n\n      this.map.flyTo({\n        center: [-122.21, 37.65], // [lng, lat]\n        zoom: 8,\n        speed: 0.5,\n      });\n    });\n  }\n\n  handleToggleCategory(e) {\n    var s = this.state.selectedCategories;\n    if (s.has(e.target.name)) {\n      s.delete(e.target.name);\n    } else {\n      s.add(e.target.name);\n    }\n    this.setState({selectedCategories: s});\n  }\n\n  handleSelectAllCategories() {\n    let normalized = DISPLAY_CATEGORIES.map(normalizeCategory);\n    this.setState({selectedCategories: new Set(normalized)});\n  }\n\n  handleDeselectAllCategories() {\n    this.setState({selectedCategories: new Set()});\n  }\n\n  handleSelectCompany(e) {\n    const selectedCompany = this.state.companiesGeojson.features.find(\n        feature => feature.properties.company === e);\n    this.displayPopup(selectedCompany);\n    this.map.flyTo({\n      center: selectedCompany.geometry.coordinates,\n      zoom: 14,\n    });\n  }\n\n  componentDidUpdate() {\n    if (this.map.getLayer(POINT_LAYER)) {\n      var filters = [\"any\"];\n      // If ANY of the 3 taxonomies for a company are selected, they should be\n      // displayed on the map.\n      const selectedCategories = this.state.selectedCategories;\n      [1, 2, 3].forEach(i => {\n        var filter = [\"in\", `tax${i}sanitized`];\n        selectedCategories.forEach(category => filter.push(category));\n        filters.push(filter);\n      });\n      this.map.setFilter(POINT_LAYER, filters);\n    }\n  }\n\n  render() {\n    return (\n      <div id=\"app-container\">\n        <div ref={el => this.mapContainer = el} id=\"map-container\" />\n        <div id=\"map-overlay\">\n          <div id=\"title-and-search\">\n            <div id=\"map-title\">Silicon Valley Energy Ecosystem, 2019</div>\n            <CompanySelector\n              companies={this.state.companiesGeojson.features}\n              onSelectCompany={this.handleSelectCompany}/>\n          </div>\n          <CompanyFilter\n            selectedCategories={this.state.selectedCategories}\n            onSelectAllCategories={this.handleSelectAllCategories}\n            onDeselectAllCategories={this.handleDeselectAllCategories}\n            onToggleCategory={this.handleToggleCategory} />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}